---
title: "Covid 19"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    navbar:
      - { title: "DATA API", href: "https://github.com/dsjena/ncv-api" }
      - { title: "World", href: "https://github.com/dsjena/ncv-wd" }
---

```{r setup, include=FALSE}
#------------------ Packages ------------------
library(flexdashboard)
load(file = "../data/indiadata.rda")
`%>%` <- magrittr::`%>%`


head(indiadata)

confirmed_color <- "#660066"
active_color <- "#0066cc"
recovered_color <- "#339933"
death_color <- " #cc0000"
#------------------ Data ------------------
df <- indiadata %>% 
  # dplyr::filter(date == max(date)) %>%
  dplyr::group_by(State, type) %>%
  dplyr::summarise(total = sum(cases)) %>%
  tidyr::pivot_wider(names_from =  type, 
                     values_from = total) %>%
  dplyr::mutate(unrecovered = confirmed - ifelse(is.na(recovered), 0, recovered) - ifelse(is.na(death), 0, death)) %>%
  dplyr::arrange(-confirmed) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(State = trimws(State)) %>%
  dplyr::mutate(State = factor(State, levels = State))

df_daily <- indiadata %>% 
  dplyr::group_by(date, type) %>%
  dplyr::summarise(total = sum(cases, na.rm = TRUE)) %>%
  tidyr::pivot_wider(names_from = type,values_from = total) %>%
  dplyr::arrange(date) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(active =  confirmed - death - recovered) %>%
  dplyr::mutate(confirmed_cum = cumsum(confirmed),
                death_cum = cumsum(death),
                recovered_cum = cumsum(recovered),
                active_cum = cumsum(active))
  
df1 <- indiadata %>% dplyr::filter(date == max(date))

```



 
Global Summary
=======================================================================

Row
-------------------------------------

### confirmed {.value-box}

```{r}
valueBox(value = paste(format(sum(df$confirmed), big.mark = ","), "", sep = " "), 
         caption = "Total Confirmed Cases", color = confirmed_color)
```


### active {.value-box}

```{r}
valueBox(value = paste(format(sum(df$unrecovered, na.rm = TRUE), big.mark = ","), " (",
                       round(100 * sum(df$unrecovered, na.rm = TRUE) / sum(df$confirmed), 1), 
                       "%)", sep = ""), caption = "Active Cases",  color = active_color)
```

### recovered {.value-box}

```{r}
valueBox(value = paste(format(sum(df$recovered, na.rm = TRUE), big.mark = ","), " (",
                       round(100 * sum(df$recovered, na.rm = TRUE) / sum(df$confirmed), 1), 
                       "%)", sep = ""), caption = "Recovered Cases", color = recovered_color)
```

### death {.value-box}

```{r}
valueBox(value = paste(format(sum(df$death, na.rm = TRUE), big.mark = ","), " (",
                       round(100 * sum(df$death, na.rm = TRUE) / sum(df$confirmed), 1), 
                       "%)", sep = ""),caption = "Death Cases", 
color = death_color)
```

Row
-------------------------------------

### Daily Cumulative Cases by Type
    
```{r}
plotly::plot_ly(data = df_daily) %>%
  plotly::add_trace(x = ~ date,
                    y = ~ active_cum,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Active",
                    line = list(color = active_color),
                    marker = list(color = active_color)) %>%
  plotly::add_trace(x = ~ date,
                    y = ~ confirmed_cum,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Confirmed",
                    line = list(color = confirmed_color),
                    marker = list(color = confirmed_color)) %>%
  plotly::add_trace(x = ~ date,
                    y = ~ recovered_cum,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Recovered",
                    line = list(color = recovered_color),
                    marker = list(color = recovered_color)) %>%
  plotly::add_trace(x = ~ date,
                    y = ~ death_cum,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Death",
                    line = list(color = death_color),
                    marker = list(color = death_color)) %>%
   
  plotly::layout(title = "",
                 yaxis = list(title = "Cumulative Number of Cases"),
                 xaxis = list(title = "Date"),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "compare")
  
```

### Recovery and Death Rates for Countries with at Least 1000 Cases

```{r}
indiadata %>% 
  #dplyr::filter(State != "Others") %>%
  dplyr::group_by(State, type) %>%
  dplyr::summarise(total_cases = sum(cases)) %>%
  tidyr::pivot_wider(names_from = type, values_from = total_cases) %>%
  dplyr::arrange(-confirmed) %>%
  dplyr::filter(confirmed >= 10) %>%
  dplyr::mutate(recover_rate = recovered / confirmed,
                death_rate = death / confirmed) %>% 
  dplyr::mutate(recover_rate = dplyr::if_else(is.na(recover_rate), 0, recover_rate),
                death_rate = dplyr::if_else(is.na(death_rate), 0, death_rate)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(confirmed_normal = as.numeric(confirmed) / max(as.numeric(confirmed))) %>%
  plotly::plot_ly(y = ~ round(10 * recover_rate, 1),
                  x = ~ round(10 * death_rate, 1),
                  size = ~  log(confirmed),
                  sizes = c(5, 70),
                  type = 'scatter', mode = 'markers',
                  color = ~ State,
                  marker = list(sizemode = 'diameter' , opacity = 0.5),
                  hoverinfo = 'text',
                  text = ~paste("", State, 
                                " Confi: ", confirmed,
                                " Recov: ", paste(round(100 * recover_rate, 1), "%", sep = ""),
                                " Death Rate: ",  paste(round(100 * death_rate, 1), "%", sep = ""))
                 ) %>%
  plotly::layout(yaxis = list(title = "Recovery Rate", ticksuffix = "%"),
                xaxis = list(title = "Death Rate", ticksuffix = "%", 
                             dtick = 1, 
                             tick0 = 0),
                hovermode = "compare")
  
```   
   


Row
-------------------------------------

### Cases(Top 20 Countries)

```{r daily_summary}
plotly::plot_ly(data = df[1:26,], 
                x = ~ State, 
                y = ~ unrecovered, 
                # text =  ~ confirmed, 
                # textposition = 'auto',
                type = "bar", 
                name = "Active",
                marker = list(color = active_color)) %>%
  plotly::add_trace(y = ~ recovered, 
                     #text =  ~ recovered, 
                     #textposition = 'auto',
                    name = "Recovered",
                    marker = list(color = recovered_color)) %>%
  plotly::add_trace(y = ~ death, 
                    # text =  ~ death, 
                    # textposition = 'auto',
                    name = "Death",
                    marker = list(color = death_color)) %>%
  plotly::layout(barmode = 'bar',
                 yaxis = list(title = "Total Cases (log scaled)",
                              type = "log"),
                 xaxis = list(title = ""),
                 hovermode = "compare",
                 margin =  list(
                   # l = 60,
                   # r = 40,
                   b = 10,
                   t = 10,
                   pad = 2
                 ))
  
```

 
 
Trends {data-orientation=columns}
=======================================================================

column {data-width=400}
-------------------------------------
    
### New Cases - Top 25 Countries (`r  max(indiadata$date)`)
    
```{r}
max_date <- max(indiadata$date)
indiadata %>% 
  dplyr::filter(type == "confirmed", date == max_date) %>%
  dplyr::group_by(State) %>%
  dplyr::summarise(total_cases = sum(cases)) %>%
  dplyr::arrange(total_cases) %>%
  dplyr::mutate(State = factor(State, levels = State)) %>%
  dplyr::ungroup() %>%
  dplyr::top_n(n = 25, wt = total_cases) %>%
  plotly::plot_ly(#x = ~ country,
                  #y = ~ total_cases,
                  x = ~ total_cases,
                  y = ~ State,
                  text = ~ total_cases,
                  textposition = 'auto',
                  type = "bar") %>%
  plotly::layout(yaxis = list(title = "Number of Cases"),
                 xaxis = list(title = ""),
                 margin =  list(
                   l = 10,
                   r = 10,
                   b = 10,
                   t = 10,
                   pad = 2
                 ))

```
   
column {data-width=600}
-------------------------------------



 
Time-series Animation
=======================================================================

### Globa Time series

```{r}

indiadata %>% 
  #dplyr::filter(State != "Others") %>%
  dplyr::group_by(State, type) %>%
  dplyr::filter(date == max(date)) %>%
  dplyr::summarise(total_cases = sum(cases)) %>%
  tidyr::pivot_wider(names_from = type, values_from = total_cases) %>%
  dplyr::arrange(-confirmed) %>%
  dplyr::ungroup() %>%
  plotly::plot_ly(x = ~ date,
                  y = ~ confirmed,
                  type = 'scatter', 
                  mode = 'markers',
                  color = ~ as.factor(State),
                  hoverinfo = 'text'
                 ) %>%
  plotly::layout(yaxis = list(title = "Recovery Rate"),
                xaxis = list(title = "Death Rate", 
                             dtick = 1, 
                             tick0 = 0),
                hovermode = "compare")


```


About
=======================================================================

**General Information**

Author has created this dashboard by the request of his firneds. You may find plenty of such dashboard put forward by lot of volunteers. The input data for this dashboard is tunnel through [api](https://github.com/RamiKrispin/indiadata). The data and dashboard is refreshed on a daily bases. The raw data pulled from the Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE) indiadata [repository](https://github.com/RamiKrispin/indiadata-csv) & upstream data produced by NYT https://github.com/nytimes/covid-19-data. This API also scraps data from Official Website of [Ministry of Health and Family Welfare](https://mohfw.gov.in). JSONS are upaded periodically to the [api](https://github.com/RamiKrispin/indiadata). 


WE DO NOT GUARANTEE ACCURACY OF THE DATA. PLEASE USE IT AS A VISUAL AID ONLY, AND DO NOT BASE ANY DECISION MEDICAL OR LOGISTICAL BASED ON THE DATA PROVIDED IN THESE CHARTS OR DATA FILES.

**Great data sources**

* [COVID tracking project](https://covidtracking.com/): State-level positive & negative tests in the US
* [CCSEGISandData](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_daily_reports): daily country & state-level case counts, also county-level data before 3/10
* [New York Times COVID-19 dataset](https://github.com/nytimes/covid-19-data): US state & county-level historical data
* [1Point3Acres](https://coronavirus.1point3acres.com/en): US & Canada county-level cases & deaths
* World Health Organization (WHO): https://www.who.int/ <br>
* DXY.cn. Pneumonia. 2020. http://3g.dxy.cn/newh5/view/pneumonia.  <br>
* BNO News: https://bnonews.com/index.php/2020/02/the-latest-coronavirus-cases/  <br>
* National Health Commission of the People’s Republic of China (NHC): <br>
 http://www.nhc.gov.cn/xcs/yqtb/list_gzbd.shtml <br>
* China CDC (CCDC): http://weekly.chinacdc.cn/news/TrackingtheEpidemic.htm <br>
* Hong Kong Department of Health: https://www.chp.gov.hk/en/features/102465.html <br>
* Macau Government: https://www.ssm.gov.mo/portal/ <br>
* Taiwan CDC: https://sites.google.com/cdc.gov.tw/2019ncov/taiwan?authuser=0 <br>
* US CDC: https://www.cdc.gov/coronavirus/2019-ncov/index.html <br>
* Government of Canada: https://www.canada.ca/en/public-health/services/diseases/coronavirus.html <br>
* Australia Government Department of Health: https://www.health.gov.au/news/coronavirus-update-at-a-glance <br>
* European Centre for Disease Prevention and Control (ECDC): https://www.ecdc.europa.eu/en/geographical-distribution-2019-ncov-cases 
* Ministry of Health Singapore (MOH): https://www.moh.gov.sg/covid-19
* Italy Ministry of Health: http://www.salute.gov.it/nuovocoronavirus
* 1Point3Arces: https://coronavirus.1point3acres.com/en
* WorldoMeters: https://www.worldometers.info/coronavirus/
* COVID Tracking Project: https://covidtracking.com/data. (US Testing and Hospitalization Data. We use the maximum reported value from "Currently" and "Cumulative" Hospitalized for our hospitalization number report ed for each state.)
of Use:</b><br>

**Acknowledgements**

This uses many open sources packages and scripts. Therefore, author acknoledges to all those distance and closure software creators.

**Contribution**

Suggestion and comments are welcome for discussion.

**Contact**

Send me mail for further queries (Many people knows this creators's email)

**License and desclaimer**

[The MIT License](https://choosealicense.com/licenses/mit/)

The data and this page related GitHub repository and its contents herein, including all data, is provided to the public strictly for educational and academic research purposes. The dataset relies upon publicly available data from multiple sources, that do not always agree. Treat the data included here as a sample data, which might be (and probably is) NOT up-to-date and contain (and probably does) contain some calculational errors, especially in historical numbers.

 
